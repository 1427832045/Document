{"TaskDefTakeTrayBackToStorage":{"id":null,"name":"TaskDefTakeTrayBackToStorage","description":"备品备料运至仓库-#2","httpApiList":[{"path":"/task-by-operator/take-tray-back-to-storage","method":"POST","reqDemoBody":"{\"menuId\":\"需要直接或者间接包含终点库位信息\",\"workType\":\"\",\"workStation\":\"\", \"params\":{\"siteId\":\"CB-1-05\", \"code\":\"test1111\"}}","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"将料车送回仓库，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.workType","message":"请求中缺少货工位信息，请先绑定工位！"},"returnName":"workType","components":[]},{"def":"AppendTaskWorkStation","params":{"workStation":"=workType"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.menuId","message":"缺少 menuId，请联系开发人员！"},"returnName":"menuId","components":[]},{"def":"GetSiteTypeByMenuId","params":{"menuId":"=menuId"},"returnName":"toSiteType","components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位"},"returnName":"fromSiteId1","components":[]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=fromSiteId1"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去起点前置点","category":"2","seqGroup":"A","stages":[{"refName":"","description":"按照创建时间执行任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProcessTasksByCreatedOn","params":{},"returnName":null,"components":[]}]},{"refName":"","description":"选择并锁定终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"=task.persistedVariables.toSiteType"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点的前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1,2","markFailed":"","content":""},"returnName":null,"components":[]}]}]},{"refName":"","description":"从起点搬运货物至终点前置点","category":"2","seqGroup":"A","stages":[{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"在终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"2","seqGroup":"A","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefTakeMatFromAE1ToAE3":{"id":null,"name":"TaskDefTakeMatFromAE1ToAE3","description":"单元满料车呼叫（弃用）","httpApiList":[],"transports":[{"refName":"","description":"去起点前置点","category":"1","seqGroup":"AE1ToAE3","stages":[{"refName":"","description":"锁定任务起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=task.persistedVariables.toSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSiteId"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"去前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1,2","markFailed":"","content":""},"returnName":null,"components":[]}]}]},{"refName":"","description":"从起点搬运货物至终点前置点","category":"1","seqGroup":"AE1ToAE3","stages":[{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"},{\"key\":\"recognize\",\"value\":\"true\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"在终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"1","seqGroup":"AE1ToAE3","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"记录货物信息","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"=task.persistedVariables.code"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefTakeEmptyTrayFromAE3ToAE1":{"id":null,"name":"TaskDefTakeEmptyTrayFromAE3ToAE1","description":"空料车返回缓存库位（弃用）","httpApiList":[{"path":"task-by-operator/take-empty-tray-from-ae3-to-ae1","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"空料车返回缓存库位，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"ThrowToWait","params":{"reason":"此功能已弃用！！！"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去前置点等待","category":"1","seqGroup":"AE3ToAE1","stages":[{"refName":"","description":"锁定起点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"AE-3-1"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"AE-3-1"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"AE-1"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=wait","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"take","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"wait","description":"去前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"1","seqGroup":"AE3ToAE1","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"EmptyTray"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefEToStation":{"id":null,"name":"TaskDefEToStation","description":"将物料从单元房运到station-#1","httpApiList":[],"transports":[{"refName":"","description":"去起点取货","category":"1","seqGroup":"e2station","stages":[{"refName":"","description":"锁定任务起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take1","value":"=take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take2","value":"=take.location"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"=task.persistedVariables.siteType"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点的前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"take","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"},{\"key\":\"recognize\",\"value\":\"true\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=take.location","content":"=\"\""},"returnName":null,"components":[]}]},{"refName":"take1","description":"解除占用起点库位","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteIdle","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"take2","description":"解锁起点库位","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"去终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"1","seqGroup":"e2station","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点放货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefStationToE":{"id":null,"name":"TaskDefStationToE","description":"将Station的空料架送回单元房-#1","httpApiList":[{"path":"task-by-operator/return-empty-tray-from-station-to-e","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"将Station的空料架送回单元房，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位！"},"returnName":"fromSiteId1","components":[]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去起点前取货","category":"1","seqGroup":"station2e","stages":[{"refName":"","description":"获取终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"AE-1"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"take","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"},{\"key\":\"recognize\",\"value\":\"true\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"去前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点卸货","category":"1","seqGroup":"station2e","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"设置货物信息","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"EmptyTray"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefTakeMatFromAE2ToAE1":{"id":null,"name":"TaskDefTakeMatFromAE2ToAE1","description":"单元满料车入库-#1","httpApiList":[{"path":"task-by-operator/take-mat-from-ae2-to-ae1","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"单元满料车入库，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.code","message":"请输入单元码！"},"returnName":"code1","components":[]},{"def":"SetTaskExtraVariables","params":{"name":"content","value":"=code1"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位！"},"returnName":"fromSiteId1","components":[]},{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"CheckStoreSiteFilled","params":{"siteId":"=fromSiteId1"},"returnName":"fromSite","components":[]},{"def":"ThrowToWait","params":{"reason":"=\"起点库位【\" + fromSiteId1 + \"】未被货物占用！\""},"returnName":null,"components":[]}]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=fromSiteId1","content":"=code1"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去前置点","category":"1","seqGroup":"AE2ToAE1","stages":[{"refName":"","description":"锁定终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"AE-1"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=take1","value":"=take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1,2","markFailed":"true","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]}]},{"refName":"","description":"从起点搬运货物至终点前置点","category":"1","seqGroup":"AE2ToAE1","stages":[{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"},{\"key\":\"recognize\",\"value\":\"true\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=take.location","content":"=\"\""},"returnName":null,"components":[]},{"def":"MarkSiteIdle","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"take1","description":"释放起点库位","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"在终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"1","seqGroup":"AE2ToAE1","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"记录货物编码","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefReturnEmptyTrayFromAtoC":{"id":null,"name":"TaskDefReturnEmptyTrayFromAtoC","description":"空料车返回缆线库位-#1>2","httpApiList":[{"path":"/task-by-operator/return-empty-tray-from-a-to-c","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"空料车返回缆线库位，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位！"},"returnName":"fromSiteId1","components":[]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"ExistTasksOfSameDef","params":{"def":"TaskDefReturnEmptyTrayFromAtoC"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=fromSiteId1"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去起点前置点等待","category":"2","seqGroup":"C","stages":[{"refName":"","description":"按照创建时间执行任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProcessTasksByCreatedOn","params":{},"returnName":null,"components":[]}]},{"refName":"","description":"获取终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"AC-2"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.25\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"在终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点卸货","category":"2","seqGroup":"C","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefReturnEmptyTrayBackToStorage":{"id":null,"name":"TaskDefReturnEmptyTrayBackToStorage","description":"空料车运至仓库-#2","httpApiList":[{"path":"/task-by-operator/return-empty-tray-back-to-storage","method":"POST","reqDemoBody":"{\"menuId\":\"需要直接或者间接包含终点库位信息\",\"workType\":\"\",\"workStation\":\"\", \"params\":{\"fromSiteId\":\"M4-2-1/M4-2-2\", \"toSiteId\":\"CB-3-1\", \"code\":\"test1111\"}}","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"将料车送回仓库，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.workType","message":"请求中缺少货工位信息，请先绑定工位！"},"returnName":"workType","components":[]},{"def":"AppendTaskWorkStation","params":{"workStation":"=workType"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位"},"returnName":"fromSiteId1","components":[]},{"def":"CheckExistedStoreSiteById","params":{"siteId":"=fromSiteId1"},"returnName":"fromSite","components":[]},{"def":"If","params":{"value":"=fromSite.locked"},"returnName":null,"components":[{"def":"ThrowToWait","params":{"reason":"=\"起点库位【\" + fromSiteId1 + \"】被锁定，无法创建任务！\""},"returnName":null,"components":[]}]},{"def":"IfNot","params":{"value":"=fromSite.filled"},"returnName":null,"components":[{"def":"ThrowToWait","params":{"reason":"=\"起点库位【\" + fromSiteId1 + \"】未被占用，无法创建任务！\""},"returnName":null,"components":[]}]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"CheckExistedStoreSiteById","params":{"siteId":"CB-3-1"},"returnName":"toSite","components":[]},{"def":"If","params":{"value":"=toSite.locked"},"returnName":null,"components":[{"def":"ThrowToWait","params":{"reason":"=\"终点库位【CB-3-1】被锁定，无法创建任务！\""},"returnName":null,"components":[]}]},{"def":"If","params":{"value":"=toSite.filled"},"returnName":null,"components":[{"def":"ThrowToWait","params":{"reason":"=\"终点库位【CB-3-1】已被占用，无法创建任务！\""},"returnName":null,"components":[]}]},{"def":"SetTaskExtraVariables","params":{"name":"toSiteId","value":"=toSite.Id"},"returnName":null,"components":[]},{"def":"ExistTasksOfSameDef","params":{"def":"TaskDefReturnEmptyTrayBackToStorage"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去起点前置点","category":"2","seqGroup":"A1","stages":[{"refName":"","description":"按照创建时间执行任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProcessTasksByCreatedOn","params":{},"returnName":null,"components":[]}]},{"refName":"","description":"设置工作站","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=take","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSiteId"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定起点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]},{"refName":"","description":"选择起点和终点的前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1, 2","markFailed":"true","content":""},"returnName":null,"components":[]}]}]},{"refName":"","description":"从起点搬运货物到终点前置点","category":"2","seqGroup":"A1","stages":[{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"在终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"2","seqGroup":"A1","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefTakeMatToPS":{"id":null,"name":"TaskDefTakeMatToPS","description":"原料运至产线-#2","httpApiList":[],"transports":[{"refName":"","description":"去起点前置点等待","category":"2","seqGroup":"B","stages":[{"refName":"","description":"按照创建时间执行任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProcessTasksByCreatedOn","params":{},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take1","value":"=take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"GetSiteTypeByPS","params":{"ps":"=task.persistedVariables.ps"},"returnName":"type","components":[]},{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"=task.persistedVariables.type"},"returnName":"toSite","components":[]}]},{"refName":"","description":"设置阶段工作站","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSite.id"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"","description":"判断叉货时是否需要识别","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"forkLoadRecognizeOrNot","params":{"siteId":"=take.location","transportIndex":"1","stageIndex":"0"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1,2,3,4,5","markFailed":"true","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]}]},{"refName":"","description":"去起点取货","category":"2","seqGroup":"B","stages":[{"refName":"take","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=take.location","content":"=\"\""},"returnName":null,"components":[]},{"def":"MarkSiteIdle","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"take1","description":"释放起点","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"去终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"2","seqGroup":"B","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]},{"refName":"","description":"尝试执行顺风车任务","category":"2","seqGroup":"B","stages":[{"refName":"","description":"尝试执行顺风车任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"tryToExecuteReturnEmptyTrayToStorage","params":{},"returnName":null,"components":[]}]}]},{"refName":"","description":"顺风车：起点取货","category":"2","seqGroup":"B","stages":[{"refName":"","description":"设置工作站","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=takeBack","value":"=task.persistedVariables.fromSiteIdBack"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=preTakeBack","value":"=\"PRE-\" + takeBack.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=placeBack","value":"=task.persistedVariables.toSiteIdBack"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlaceBack","value":"=\"PRE-\" + placeBack.location"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=takeBack.location"},"returnName":null,"components":[]}]},{"refName":"","description":"锁定任务终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=placeBack.location"},"returnName":null,"components":[]}]},{"refName":"preTakeBack","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=takeBack.location","toSiteId":"=placeBack.location","transportIndexes":"3,4","markFailed":"false","content":""},"returnName":null,"components":[]}]},{"refName":"takeBack","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=takeBack.location"},"returnName":null,"components":[]}]},{"refName":"prePlaceBack","description":"去终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"顺风车：终点放货","category":"2","seqGroup":"B","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=placeBack.location"},"returnName":"filled1","components":[]},{"def":"If","params":{"value":"=filled1"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + placeBack.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=placeBack.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"placeBack","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=placeBack.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefTakeEmptyTrayFromAE1ToAE2":{"id":null,"name":"TaskDefTakeEmptyTrayFromAE1ToAE2","description":"空料车呼叫-#1","httpApiList":[{"path":"task-by-operator/take-empty-tray-from-ae1-to-ae2","method":"POST","reqDemoBody":"{\"menuId\":\"需要直接或者间接包含终点库位信息\",\"workType\":\"\",\"workStation\":\"\", \"params\":{\"siteId\":\"CB-1-05\", \"code\":\"test1111\"}}","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"空料车呼叫，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.workType","message":"请选择岗位！"},"returnName":"workType","components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.workStation","message":"请选择工位！"},"returnName":"workStation","components":[]},{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"LockOneSiteFilledWithEmptyTrayByType","params":{"type":"AE-1"},"returnName":"fromSite","components":[]},{"def":"ThrowToWait","params":{"reason":"单元房【AE-1】中没有被【空托盘】占用，且未被锁定的库位！"},"returnName":null,"components":[]}]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=task.persistedVariables.fromSite.id"},"returnName":null,"components":[]},{"def":"SetTaskExtraVariables","params":{"name":"content","value":"空料车"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"ExistTasksOfSameDef","params":{"def":"TaskDefTakeEmptyTrayFromAE1ToAE2"},"returnName":null,"components":[]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"AE-2-1","extMsg":"=\"请根据实际情况解锁库位【\" + fromSite.id + \"】！\""},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"AE-2-1"},"returnName":null,"components":[]},{"def":"AppendTaskWorkType","params":{"workType":"=workType"},"returnName":null,"components":[]},{"def":"AppendTaskWorkStation","params":{"workStation":"=workStation"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去前置点等待","category":"1","seqGroup":"AE1ToAE2","stages":[{"refName":"","description":"设置终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"take","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.15\"},{\"key\":\"recognize\",\"value\":\"true\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=take.location","content":"=\"\""},"returnName":null,"components":[]},{"def":"MarkSiteIdle","params":{"siteId":"=take.location"},"returnName":null,"components":[]},{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"去前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点","category":"1","seqGroup":"AE1ToAE2","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefFromAreaCToStorageA":{"id":null,"name":"TaskDefFromAreaCToStorageA","description":"缆线运至仓库-#1>2","httpApiList":[{"path":"/task-by-operator/take-mat-from-area-c-to-storage-a","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"RecordMessageIntoLog","params":{"message":"=\"缆线运至仓库，body=\" + httpBody.toString()"},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.code","message":"请输入产品编码！"},"returnName":"code","components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSiteId","message":"请输入起点库位！"},"returnName":"fromSiteId1","components":[]},{"def":"SetTaskExtraVariables","params":{"name":"fromSiteId","value":"=fromSiteId1"},"returnName":null,"components":[]},{"def":"SetTaskExtraVariables","params":{"name":"content","value":"=code"},"returnName":null,"components":[]},{"def":"ExistTasksOfSameDef","params":{"def":"TaskDefFromAreaCToStorageA"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take","value":"=fromSiteId"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=fromSiteId","content":"=code"},"returnName":null,"components":[]},{"def":"TryToLockSiteIfNotLocked","params":{"siteId":"=fromSiteId"},"returnName":null,"components":[]}]}],"transports":[{"refName":"","description":"去起点前置点等待","category":"2","seqGroup":"C","stages":[{"refName":"","description":"按照创建时间执行任务","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProcessTasksByCreatedOn","params":{},"returnName":null,"components":[]}]},{"refName":"","description":"获取终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToLockEmptyAndUnlockedSiteOfType","params":{"type":"CA-3"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=place","value":"=task.persistedVariables.toSite.id"},"returnName":null,"components":[]}]},{"refName":"","description":"设置起点和终点前置点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=preTake","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=take1","value":"=\"PRE-\" + take.location"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=prePlace","value":"=\"PRE-\" + place.location"},"returnName":null,"components":[]}]},{"refName":"preTake","description":"在起点前置点判断起点是否有货","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SkipTransportsIfFromSiteNotFilledWithContent","params":{"fromSiteId":"=take.location","toSiteId":"=place.location","transportIndexes":"1,2","markFailed":"true","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]}]},{"refName":"","description":"从起点搬运货物至终点前置点","category":"2","seqGroup":"C","stages":[{"refName":"take","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.25\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=take.location","content":"=\"\""},"returnName":null,"components":[]},{"def":"MarkSiteNotIdle","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"take1","description":"释放起点资源","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=take.location"},"returnName":null,"components":[]}]},{"refName":"prePlace","description":"去终点前置点等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"","description":"去终点卸货","category":"2","seqGroup":"C","stages":[{"refName":"","description":"当终点有货时，告知PDA","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilled","params":{"siteId":"=place.location"},"returnName":"filled","components":[]},{"def":"If","params":{"value":"=filled"},"returnName":null,"components":[{"def":"AlertOperator","params":{"message":"=\"库位【\" + place.location + \"】上有货物！\"","workStations":"","workTypes":"","all":"true"},"returnName":null,"components":[]}]}]},{"refName":"","description":"当终点有货时，任务显示警告","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"checkSiteFilledAndThrowErrorIfFilled","params":{"siteId":"=place.location","errMsg":""},"returnName":null,"components":[]}]},{"refName":"place","description":"去终点卸货","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.084\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=place.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=place.location","content":"=task.persistedVariables.content"},"returnName":null,"components":[]}]},{"refName":"","description":"释放终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryToUnLockSite","params":{"siteId":"=place.location"},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false}}