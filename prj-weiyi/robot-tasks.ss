{"TaskDefSortProduct":{"id":null,"name":"TaskDefSortProduct","description":"整理已入库的成品","httpApiList":[],"transports":[{"refName":"sort-product","description":"整理已入库的货物","category":"","seqGroup":"sort","stages":[{"refName":"allocate","description":"分配资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"RecordExecutingSequence","params":{},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=transport.stages[1]","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=transport.stages[2]","value":"=\"PRE-\" + task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=transport.stages[3]","value":"=task.persistedVariables.toSiteId"},"returnName":null,"components":[]},{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=transport.stages[1].location"},"returnName":null,"components":[]},{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=transport.stages[3].location"},"returnName":null,"components":[]},{"def":"GetContentOfStoreSite","params":{"siteId":"=transport.stages[1].location"},"returnName":"content","components":[]}]},{"refName":"take-product","description":"在起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.83\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"unlock-fromSite","description":"解锁起点","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=transport.stages[1].location","content":"=\"\""},"returnName":null,"components":[]},{"def":"MarkSiteIdle","params":{"siteId":"=transport.stages[1].location"},"returnName":null,"components":[]},{"def":"UnlockSiteIfLocked","params":{"siteId":"=transport.stages[1].location"},"returnName":null,"components":[]}]},{"refName":"place-product","description":"在终点放置货物","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProductSortFinished","params":{"fmono":"=task.persistedVariables.content","oldSite":"=transport.stages[1].location","newSite":"=transport.stages[3].location"},"returnName":null,"components":[]}]},{"refName":"release","description":"释放资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=transport.stages[3].location","content":"=task.persistedVariables.content"},"returnName":null,"components":[]},{"def":"MarkSiteNotIdle","params":{"siteId":"=transport.stages[3].location"},"returnName":null,"components":[]},{"def":"UnlockSiteIfLocked","params":{"siteId":"=transport.stages[3].location"},"returnName":null,"components":[]},{"def":"MarkExecutingSequenceFinished","params":{},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefReturnEmptyTray":{"id":null,"name":"TaskDefReturnEmptyTray","description":"送回空料架","httpApiList":[{"path":"/task-by-operator/return-empty-tray","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"ExistUnfinishedReturnEmptyTrayTask","params":{},"returnName":null,"components":[]},{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"G"},"returnName":null,"components":[]},{"def":"ThrowToWait","params":{"reason":"锁定库位【G】失败，请检查库位【G】的状态"},"returnName":null,"components":[]}]},{"def":"SetLocationName","params":{"destination":"=takeEmptyTray","value":"G"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=toToSite","value":"H"},"returnName":null,"components":[]},{"def":"SetPriority","params":{"priority":"30"},"returnName":null,"components":[]}]}],"transports":[{"refName":"takeEmptyTrayToPreSite","description":"将空托盘搬从起点搬到起点的前置点","category":"","seqGroup":"return","stages":[{"refName":"","description":"任务是否可执行","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"CheckCurrentTransportSendable","params":{},"returnName":null,"components":[]},{"def":"RecordExecutingSequence","params":{},"returnName":null,"components":[]}]},{"refName":"allocate","description":"锁定终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=toToSite.location"},"returnName":null,"components":[]}]},{"refName":"takeEmptyTray","description":"去起点取货","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.83\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"toToSite","description":"将空托盘搬到终点","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"unlockFormSite","description":"解锁起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"UnlockSiteIfLocked","params":{"siteId":"=takeEmptyTray.location"},"returnName":null,"components":[]}]},{"refName":"unlockToSite","description":"解锁终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"UnlockSiteIfLocked","params":{"siteId":"=toToSite.location"},"returnName":null,"components":[]},{"def":"MarkExecutingSequenceFinished","params":{},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefProductIn":{"id":null,"name":"TaskDefProductIn","description":"成品入库","httpApiList":[{"path":"/task-by-operator/product-in","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"TrimRequired","params":{"value":"=httpBody.workStation","message":"缺少工作站信息"},"returnName":"workStation","components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.fromSite","message":"起点不能为空"},"returnName":"fromSiteId","components":[]},{"def":"CompareMatch","params":{"v1":"=workStation","v2":"=fromSiteId.substring(0, 1)","operator":"=\"=\"","message":"=\"目前绑定的工位为【\"+workStation+\"】！请选择区域【\"+workStation+\"】的库位！\""},"returnName":null,"components":[]},{"def":"TrimRequired","params":{"value":"=httpBody.params.code","message":"产品信息不能为空"},"returnName":"productCode","components":[]},{"def":"PersistProductInfo","params":{"productCode":"=productCode"},"returnName":"productInfo","components":[]},{"def":"FromSiteAvailable","params":{"fromSiteId":"=fromSiteId","code":"=productCode"},"returnName":"fromSite","components":[]},{"def":"CheckToSiteAvailableByFromSite","params":{"fromSiteId":"=fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=getProduct","value":"=fromSite.id"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=unlockFromSite","value":"=\"PRE-\" + fromSiteId"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=fromSite.id","content":"=productCode"},"returnName":null,"components":[]},{"def":"SetPriority","params":{"priority":"10"},"returnName":null,"components":[]}]}],"transports":[{"refName":"product-in","description":"成品入库","category":"","seqGroup":"in","stages":[{"refName":"","description":"任务是否可执行","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"CheckCurrentTransportSendable","params":{},"returnName":null,"components":[]},{"def":"RecordExecutingSequence","params":{},"returnName":null,"components":[]}]},{"refName":"lockToSite","description":"锁定终点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"getToSiteByFromSite","params":{"fromSite":"=getProduct.location"},"returnName":"toSite","components":[]},{"def":"SetLocationName","params":{"destination":"=placeProduct","value":"=toSite.id"},"returnName":null,"components":[]}]},{"refName":"lockFromSite","description":"锁定起点","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=getProduct.location"},"returnName":null,"components":[]}]},{"refName":"getProduct","description":"在起点取料","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"start_height\",\"value\":\"0\"},{\"key\":\"end_height\",\"value\":\"0.83\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"unlockFromSite","description":"解锁起点库位","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"UnlockSiteIfLocked","params":{"siteId":"=getProduct.location"},"returnName":null,"components":[]},{"def":"SetSiteContent","params":{"siteId":"=getProduct.location","content":"=\"\""},"returnName":null,"components":[]}]},{"refName":"placeProduct","description":"在终点放料","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProductStoreIn","params":{"site":"=placeProduct.location"},"returnName":null,"components":[]}]},{"refName":"release","description":"释放资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetSiteContent","params":{"siteId":"=placeProduct.location","content":"=task.persistedVariables.productInfo"},"returnName":null,"components":[]},{"def":"MarkSiteNotIdle","params":{"siteId":"=placeProduct.location"},"returnName":null,"components":[]},{"def":"UnlockSiteIfLocked","params":{"siteId":"=placeProduct.location"},"returnName":null,"components":[]},{"def":"MarkExecutingSequenceFinished","params":{},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefProductOut":{"id":null,"name":"TaskDefProductOut","description":"成品出库","httpApiList":[],"transports":[{"refName":"product-out","description":"去起点取货","category":"","seqGroup":"out","stages":[{"refName":"","description":"任务是否可执行","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"CheckCurrentTransportSendable","params":{},"returnName":null,"components":[]},{"def":"RecordExecutingSequence","params":{},"returnName":null,"components":[]}]},{"refName":"lockFromSite","description":"锁定起点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"SetLocationName","params":{"destination":"=takeProduct","value":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=unlockFromSite","value":"=\"PRE-\" + takeProduct.location"},"returnName":null,"components":[]},{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=task.persistedVariables.fromSiteId"},"returnName":null,"components":[]},{"def":"AppendTaskWorkStation","params":{"workStation":"PS"},"returnName":null,"components":[]},{"def":"AppendTaskWorkType","params":{"workType":"F"},"returnName":null,"components":[]},{"def":"ThrowToWait","params":{"reason":"=\"锁定起点库位【\" + takeProduct.location + \"】失败\""},"returnName":null,"components":[]}]}]},{"refName":"lockBufferSite","description":"锁定缓存区库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"LockIdleSiteOfType","params":{"type":"K"},"returnName":"siteK","components":[]},{"def":"SetLocationName","params":{"destination":"=bufferSite","value":"=siteK.id"},"returnName":null,"components":[]},{"def":"SetLocationName","params":{"destination":"=toBufSiteWaiting","value":"K-1"},"returnName":null,"components":[]},{"def":"ThrowToWait","params":{"reason":"\"缓存区没有可用的空库位\""},"returnName":null,"components":[]}]}]},{"refName":"setToSite","description":"设置终点库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"SetLocationName","params":{"destination":"=placeProduct","value":"F"},"returnName":null,"components":[]}]},{"refName":"takeProduct","description":"在起点取料","forRoute":true,"operation":"ForkLoad","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.83\"}]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"unlockFromSite","description":"解锁起点库位","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"ClearContentOfStoreSite","params":{"siteId":"=takeProduct.location"},"returnName":null,"components":[]},{"def":"MarkSiteIdle","params":{"siteId":"=takeProduct.location"},"returnName":null,"components":[]},{"def":"UnlockSiteIfLocked","params":{"siteId":"=takeProduct.location"},"returnName":null,"components":[]}]},{"refName":"release","description":"释放资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"takeProductToBuffer","description":"将满托盘搬到缓存位置","category":"","seqGroup":"out","stages":[{"refName":"bufferSite","description":"分配资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"toBufSiteWaiting","description":"去缓存库位等待","forRoute":true,"operation":"Wait","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]},{"refName":"","description":"释放资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[]}]},{"refName":"placeProductOnF","description":"将满托盘搬到成品发货位置","category":"","seqGroup":"out","stages":[{"refName":"","description":"分配资源","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"TryCatch","params":{},"returnName":null,"components":[{"def":"CheckStoreSiteEmpty","params":{"siteId":"=placeProduct.location"},"returnName":"siteF2","components":[]},{"def":"LockSiteOnlyIfNotLock","params":{"siteId":"=placeProduct.location"},"returnName":null,"components":[]},{"def":"ThrowToWait","params":{"reason":"终点库位不可用，请及时处理库位【F】"},"returnName":null,"components":[]}]}]},{"refName":"placeProduct","description":"去成品发货位置放置满料架","forRoute":true,"operation":"ForkUnload","location":"","properties":"[{\"key\":\"end_height\",\"value\":\"0.0\"}]","maxRetries":null,"retryDelay":null,"components":[{"def":"ProductStoreOut","params":{"fmono":"=task.persistedVariables.fmono","fromSiteId":"=takeProduct.location"},"returnName":null,"components":[]}]},{"refName":"","description":"占用库位【F】","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"MarkSiteNotIdle","params":{"siteId":"=placeProduct.location"},"returnName":null,"components":[]}]},{"refName":"","description":"解锁库位【F】","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"UnlockSiteIfLocked","params":{"siteId":"=placeProduct.location"},"returnName":null,"components":[]}]},{"refName":"","description":"解锁缓存库位","forRoute":false,"operation":"","location":"","properties":"[]","maxRetries":null,"retryDelay":null,"components":[{"def":"UnlockSiteIfLocked","params":{"siteId":"=bufferSite.location"},"returnName":null,"components":[]},{"def":"MarkExecutingSequenceFinished","params":{},"returnName":null,"components":[]}]}]}],"static":false,"parallel":false,"noTransport":false},"TaskDefBuildProductOutTasks":{"id":null,"name":"TaskDefBuildProductOutTasks","description":"创建成品出库任务","httpApiList":[{"path":"/task-by-operator/build-product-out-task","method":"POST","reqDemoBody":"","successResponseCode":201,"responseDecorator":"","components":[{"def":"TrimRequired","params":{"value":"=httpBody.params.productInfo","message":"缺少任务信息"},"returnName":"productInfo","components":[]},{"def":"BuildTaskProductOut","params":{"taskInfos":"=productInfo"},"returnName":null,"components":[]}]}],"transports":[],"static":false,"parallel":false,"noTransport":true}}